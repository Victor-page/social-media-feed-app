(this["webpackJsonpredux-essentials-example"]=this["webpackJsonpredux-essentials-example"]||[]).push([[0],{1314:function(t,e){},1322:function(t,e,n){"use strict";n.r(e);var r,a=n(25),s=n(9),c=n.n(s),i=n(3),o=n.n(i),u=n(76),d=n.n(u),j=n(10),l=(n(149),n(18)),b=n(15),p=n(12),f=n(27),O=n(5),h=n(28),m=n(41),v=n(133),x=n(32),y=n(34),g=n(81),N=n(29),S=n(37),w=n.n(S),k=n(104),P=n.n(k),I=n(137),A=n(138),C=n(114),q=["id"],T=2e3,F=P()(),U=localStorage.getItem("randomTimestampSeed");function M(t,e){return t=Math.ceil(t),e=Math.floor(e),Math.floor(F()*(e-t+1))+t}U?r=new Date(U):(U=(r=new Date).toISOString(),localStorage.setItem("randomTimestampSeed",U)),F=P()(U),Object(A.setRandom)(F),w.a.seed(r.getTime());for(var E,D=function(t){return t[M(0,t.length-1)]},R=Object(N.factory)({user:{id:Object(N.primaryKey)(O.n),firstName:String,lastName:String,name:String,username:String,posts:Object(N.manyOf)("post")},post:{id:Object(N.primaryKey)(O.n),title:String,date:String,content:String,reactions:Object(N.oneOf)("reaction"),comments:Object(N.manyOf)("comment"),user:Object(N.oneOf)("user")},comment:{id:Object(N.primaryKey)(String),date:String,text:String,post:Object(N.oneOf)("post")},reaction:{id:Object(N.primaryKey)(O.n),thumbsUp:Number,hooray:Number,heart:Number,rocket:Number,eyes:Number,post:Object(N.oneOf)("post")}}),L=function(){var t=w.a.name.firstName(),e=w.a.name.lastName();return{firstName:t,lastName:e,name:"".concat(t," ").concat(e),username:w.a.internet.userName()}},Q=0;Q<3;Q++)for(var J=R.user.create(L()),G=0;G<3;G++){var K=(E=J,{title:w.a.lorem.words(),date:w.a.date.recent(7).toISOString(),user:E,content:w.a.lorem.paragraphs(),reactions:R.reaction.create()});R.post.create(K)}var B,W=function(t){return Object(x.a)(Object(x.a)({},t),{},{user:t.user.id})},z=[y.e.get("/fakeApi/posts",(function(t,e,n){var r=R.post.getAll().map(W);return e(n.delay(T),n.json(r))})),y.e.post("/fakeApi/posts",(function(t,e,n){var r=t.body;if("error"===r.content)return e(n.delay(T),n.status(500),n.json("Server error saving this post!"));r.date=(new Date).toISOString();var a=R.user.findFirst({where:{id:{equals:r.user}}});r.user=a,r.reactions=R.reaction.create();var s=R.post.create(r);return e(n.delay(T),n.json(W(s)))})),y.e.get("/fakeApi/posts/:postId",(function(t,e,n){var r=R.post.findFirst({where:{id:{equals:t.params.postId}}});return e(n.delay(T),n.json(W(r)))})),y.e.patch("/fakeApi/posts/:postId",(function(t,e,n){var r=t.body,a=(r.id,Object(v.a)(r,q)),s=R.post.update({where:{id:{equals:t.params.postId}},data:a});return e(n.delay(T),n.json(W(s)))})),y.e.get("/fakeApi/posts/:postId/comments",(function(t,e,n){var r=R.post.findFirst({where:{id:{equals:t.params.postId}}});return e(n.delay(T),n.json({comments:r.comments}))})),y.e.post("/fakeApi/posts/:postId/reactions",(function(t,e,n){var r=t.params.postId,a=t.body.reaction,s=R.post.findFirst({where:{id:{equals:r}}}),c=R.post.update({where:{id:{equals:r}},data:{reactions:Object(x.a)(Object(x.a)({},s.reactions),{},Object(m.a)({},a,s.reactions[a]+=1))}});return e(n.delay(T),n.json(W(c)))})),y.e.get("/fakeApi/notifications",(function(t,e,n){var r=Z(void 0,M(1,5),R);return e(n.delay(T),n.json(r))})),y.e.get("/fakeApi/users",(function(t,e,n){return e(n.delay(T),n.json(R.user.getAll()))}))],H=g.setupWorker.apply(void 0,z),V=new I.Server("ws://localhost"),X=function(t,e){!function(t,e){t.send(JSON.stringify(e))}(t,{type:"notifications",payload:Z(e,M(1,5),R)})};V.on("connection",(function(t){B=t,t.on("message",(function(e){var n=JSON.parse(e);if("notifications"===n.type){var r=n.payload;X(t,r)}}))}));var Y=["poked you","says hi!","is glad we're friends","sent you a gift"];function Z(t,e,n){var r,a=new Date;t?r=Object(C.a)(t):(r=new Date(a.valueOf())).setMinutes(r.getMinutes()-15);var s=Object(f.a)(Array(e)).map((function(){var t=D(n.user.getAll()),e=D(Y);return{id:Object(O.n)(),date:w.a.date.between(r,a).toISOString(),message:e,user:t.id}}));return s}var $=n(139),_=n(21),tt=n(89),et="users",nt="posts",rt="reactions",at="notifications",st=Object($.a)({reducerPath:"api",baseQuery:Object(_.d)({baseUrl:"/fakeApi"}),tagTypes:["Post"],endpoints:function(t){return{getPosts:t.query({query:function(){return"/"+nt},providesTags:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];return["Post"].concat(Object(f.a)(t.map((function(t){return{type:"Post",id:t.id}}))))}}),getPost:t.query({query:function(t){return"/".concat(nt,"/").concat(t)},providesTags:function(t,e,n){return[{type:"Post",id:n}]}}),addNewPost:t.mutation({query:function(t){return{url:"/"+nt,method:tt.a.POST,body:t}},invalidatesTags:["Post"]}),editPost:t.mutation({query:function(t){return{url:"/".concat(nt,"/").concat(t.id),method:tt.a.PATCH,body:t}},invalidatesTags:function(t,e,n){return[{type:"Post",id:n.id}]}}),addReaction:t.mutation({query:function(t){var e=t.postId,n=t.reaction;return{url:"/".concat(nt,"/").concat(e,"/").concat(rt),method:tt.a.POST,body:{reaction:n}}},onQueryStarted:function(t,e){return Object(a.a)(c.a.mark((function n(){var r,a,s,i,o,u;return c.a.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return r=t.postId,a=t.reaction,s=e.dispatch,i=e.queryFulfilled,o=function(t){var e=t.find((function(t){return t.id===r}));if(e){var n=e.reactions,s=n[a];n[a]=s+1}},u=s(st.util.updateQueryData("getPosts",void 0,o)),n.prev=4,n.next=7,i;case 7:n.next=12;break;case 9:n.prev=9,n.t0=n.catch(4),u.undo();case 12:case"end":return n.stop()}}),n,null,[[4,9]])})))()}})}}}),ct=st.useGetPostsQuery,it=st.useGetPostQuery,ot=st.useAddNewPostMutation,ut=st.useEditPostMutation,dt=st.useAddReactionMutation,jt=Object(O.b)("notifications/notificationsReceived"),lt=st.injectEndpoints({endpoints:function(t){return{getNotifications:t.query({query:function(){return"/"+at},onCacheEntryAdded:function(t,e){return Object(a.a)(c.a.mark((function t(){var n,r,a,s,i,o;return c.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return n=e.updateCachedData,r=e.cacheDataLoaded,a=e.cacheEntryRemoved,s=e.dispatch,i=new WebSocket("ws://localhost"),t.prev=2,t.next=5,r;case 5:o=function(t){var e=JSON.parse(t.data);if(e.type===at)n((function(t){t.push.apply(t,Object(f.a)(e.payload)),t.sort((function(t,e){return e.date.localeCompare(t.date)}))})),s(jt(e.payload))},i.addEventListener("message",o),t.next=12;break;case 9:t.prev=9,t.t0=t.catch(2),console.log(t.t0);case 12:return t.next=14,a;case 14:i.close();case 15:case"end":return t.stop()}}),t,null,[[2,9]])})))()}})}}}),bt=lt.useGetNotificationsQuery,pt=[],ft=lt.endpoints.getNotifications.select(),Ot=Object(h.a)(ft,(function(t){var e;return null!==(e=t.data)&&void 0!==e?e:pt})),ht=function(){return function(t,e){var n,r=Ot(e()),a=Object(p.a)(r,1)[0],s=null!==(n=null===a||void 0===a?void 0:a.date)&&void 0!==n?n:"";X(B,s)}},mt=Object(O.d)(),vt=Object(O.g)(jt,lt.endpoints.getNotifications.matchFulfilled),xt=mt.getInitialState(),yt=Object(O.e)({name:"notifications",initialState:xt,reducers:{allNotificationsRead:function(t,e){Object.values(t.entities).forEach((function(t){return t.read=!0}))}},extraReducers:function(t){t.addMatcher(vt,(function(t,e){var n=e.payload.map((function(t){return{id:t.id,read:!1,isNew:!0}}));Object.values(t.entities).forEach((function(t){return t.isNew=!t.read})),mt.upsertMany(t,n)}))}}),gt=yt.reducer,Nt=yt.actions.allNotificationsRead,St=gt,wt=mt.getSelectors((function(t){return t.notifications})),kt=wt.selectAll,Pt=wt.selectEntities,It=n(4),At=function(){var t=Object(j.d)();bt();var e,n=Object(j.e)(kt).filter((function(t){return!t.read})).length;return n>0&&(e=Object(It.jsx)("span",{className:"badge",children:n})),Object(It.jsx)("nav",{children:Object(It.jsx)("section",{children:Object(It.jsxs)("div",{className:"navContent",children:[Object(It.jsxs)("div",{className:"navLinks",children:[Object(It.jsx)(l.b,{to:"/",children:"Posts"}),Object(It.jsx)(l.b,{to:"/users",children:"Users"}),Object(It.jsxs)(l.b,{to:"/notifications",children:["Notifications ",e]})]}),Object(It.jsx)("button",{className:"button",onClick:function(){t(ht())},children:"Refresh Notifications"})]})})})},Ct=Object(O.d)(),qt=Ct.getInitialState(),Tt=st.injectEndpoints({endpoints:function(t){return{getUsers:t.query({query:function(){return"/"+et},transformResponse:function(t){return Ct.setAll(qt,t)}})}}}),Ft=(Tt.useGetUsersQuery,Tt.endpoints.getUsers.select()),Ut=Object(h.a)(Ft,(function(t){return t.data})),Mt=Ct.getSelectors((function(t){var e;return null!==(e=Ut(t))&&void 0!==e?e:qt})),Et=Mt.selectAll,Dt=Mt.selectById,Rt=function(){var t=Object(i.useState)(""),e=Object(p.a)(t,2),n=e[0],r=e[1],s=Object(i.useState)(""),o=Object(p.a)(s,2),u=o[0],d=o[1],l=Object(i.useState)(""),b=Object(p.a)(l,2),f=b[0],O=b[1],h=ot(),m=Object(p.a)(h,2),v=m[0],x=m[1].isLoading,y=Object(j.e)(Et),g=[n,u,f].every(Boolean)&&!x,N=function(){var t=Object(a.a)(c.a.mark((function t(e){return c.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(e.preventDefault(),g){t.next=3;break}return t.abrupt("return");case 3:return t.prev=3,t.next=6,v({title:n,content:u,user:f}).unwrap();case 6:t.next=11;break;case 8:t.prev=8,t.t0=t.catch(3),console.error("Failed to save the post: ",t.t0);case 11:return t.prev=11,r(""),d(""),O(""),t.finish(11);case 14:case"end":return t.stop()}}),t,null,[[3,8,11,14]])})));return function(e){return t.apply(this,arguments)}}(),S=y.map((function(t){var e=t.id,n=t.name;return Object(It.jsx)("option",{value:e,children:n},e)}));return Object(It.jsxs)("section",{children:[Object(It.jsx)("h2",{children:"Add a New Post"}),Object(It.jsxs)("form",{onSubmit:N,children:[Object(It.jsx)("label",{htmlFor:"postTitle",children:"Post Title:"}),Object(It.jsx)("input",{type:"text",id:"postTitle",name:"postTitle",value:n,onChange:function(t){var e=t.target;return r(e.value)}}),Object(It.jsx)("label",{htmlFor:"postAuthor",children:"Author:"}),Object(It.jsxs)("select",{id:"postAuthor",value:f,onChange:function(t){var e=t.target;return O(e.value)},children:[Object(It.jsx)("option",{value:""}),S]}),Object(It.jsx)("label",{htmlFor:"postContent",children:"Post:"}),Object(It.jsx)("textarea",{type:"text",id:"postContent",name:"postContent",value:u,onChange:function(t){var e=t.target;return d(e.value)}}),Object(It.jsx)("button",{type:"submit",disabled:!g,children:"Save Post"})]})]})},Lt=function(t){var e=t.userId,n=Object(j.e)((function(t){return Dt(t,e)}));return Object(It.jsxs)("span",{children:["by ",n?n.name:"Unknown author"]})},Qt={thumbsUp:"\ud83d\udc4d",hooray:"\ud83c\udf89",heart:"\u2764\ufe0f",rocket:"\ud83d\ude80",eyes:"\ud83d\udc40"},Jt=function(t){var e=t.post,n=dt(),r=Object(p.a)(n,1)[0],a=Object.entries(Qt).map((function(t){var n=Object(p.a)(t,2),a=n[0],s=n[1];return Object(It.jsxs)("button",{type:"button",className:"muted-button reaction-button",onClick:function(){return r({postId:e.id,reaction:a})},children:[s," ",e.reactions[a]]},a)}));return Object(It.jsx)("div",{children:a})},Gt=n(113),Kt=function(t){var e=t.timestamp,n="";if(e){var r=Object(C.a)(e),a=Object(Gt.a)(r);n="".concat(a," ago")}return Object(It.jsxs)("span",{title:e,children:["\xa0 ",Object(It.jsx)("i",{children:n})]})},Bt=function(t){var e=t.text,n=void 0===e?"":e,r=t.size,a=void 0===r?"5em":r,s=n?Object(It.jsx)("h4",{children:n}):null;return Object(It.jsxs)("div",{className:"spinner",children:[s,Object(It.jsx)("div",{className:"loader",style:{height:a,width:a}})]})},Wt=n(88),zt=n.n(Wt),Ht=function(t){var e=t.post,n=e.title,r=e.user,a=e.date,s=e.id,c=e.content;return Object(It.jsxs)("article",{className:"post-excerpt",children:[Object(It.jsx)("h3",{children:n}),Object(It.jsxs)("div",{children:[Object(It.jsx)(Lt,{userId:r}),Object(It.jsx)(Kt,{timestamp:a})]}),Object(It.jsx)("p",{className:"post-content",children:c.substring(0,100)}),Object(It.jsx)(Jt,{post:e}),Object(It.jsx)(l.b,{to:"/posts/".concat(s),className:"button muted-button",children:"View Post"})]})},Vt=function(){var t,e=ct(),n=e.data,r=void 0===n?[]:n,a=e.isLoading,s=e.isFetching,c=e.isSuccess,o=e.isError,u=e.error,d=Object(i.useMemo)((function(){var t=r.slice();return t.sort((function(t,e){return e.date.localeCompare(t.date)})),t}),[r]);if(a)t=Object(It.jsx)(Bt,{text:"Loading..."});else if(c){var j=zt()("posts-container",{disabled:s});t=Object(It.jsx)("div",{className:j,children:d.map((function(t){return Object(It.jsx)(Ht,{post:t},t.id)}))})}else o&&(t=Object(It.jsx)("p",{children:u.toString()}));return Object(It.jsxs)("section",{className:"posts-list",children:[Object(It.jsx)("h2",{children:"Posts"}),t]})},Xt=function(t){var e,n=t.match.params.postId,r=it(n),a=r.data,s=r.isFetching,c=r.isSuccess;if(s)e=Object(It.jsx)(Bt,{text:"Loading"});else if(c){var i=a.user,o=a.id,u=a.title,d=a.content,j=a.date;e=Object(It.jsxs)("article",{className:"post",children:[Object(It.jsx)("h2",{children:u}),Object(It.jsxs)("div",{children:[Object(It.jsx)(Lt,{userId:i}),Object(It.jsx)(Kt,{timestamp:j})]}),Object(It.jsx)("p",{className:"post-content",children:d}),Object(It.jsx)(Jt,{post:a}),Object(It.jsx)(l.b,{to:"/edit-post/".concat(o),className:"button",children:"Edit Post"})]})}return Object(It.jsx)("section",{children:e})},Yt=function(t){var e=t.match.params.postId,n=it(e).data,r=ut(),s=Object(p.a)(r,1)[0],o=Object(i.useState)(n.title),u=Object(p.a)(o,2),d=u[0],j=u[1],l=Object(i.useState)(n.content),f=Object(p.a)(l,2),O=f[0],h=f[1],m=Object(b.g)(),v=function(){var t=Object(a.a)(c.a.mark((function t(n){return c.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(n.preventDefault(),d&&O){t.next=3;break}return t.abrupt("return");case 3:return t.next=5,s({id:e,title:d,content:O});case 5:m.push("/posts/".concat(e));case 6:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}();return Object(It.jsxs)("section",{children:[Object(It.jsx)("h2",{children:"Edit Post"}),Object(It.jsxs)("form",{onSubmit:v,children:[Object(It.jsx)("label",{htmlFor:"postTitle",children:"Post Title:"}),Object(It.jsx)("input",{type:"text",id:"postTitle",name:"postTitle",placeholder:"What's on your mind?",value:d,onChange:function(t){return j(t.target.value)}}),Object(It.jsx)("label",{htmlFor:"postContent",children:"Content:"}),Object(It.jsx)("textarea",{id:"postContent",name:"postContent",value:O,onChange:function(t){return h(t.target.value)}}),Object(It.jsx)("button",{type:"submit",children:"Save Post"})]})]})},Zt=function(){var t=Object(j.e)(Et).map((function(t){var e=t.id,n=t.name;return Object(It.jsx)("li",{children:Object(It.jsx)(l.b,{to:"/users/".concat(e),children:n})},e)}));return Object(It.jsxs)("section",{children:[Object(It.jsx)("h2",{children:"Users"}),Object(It.jsx)("ul",{children:t})]})},$t=function(t){var e=t.match.params.userId,n=Object(j.e)((function(t){return Dt(t,e)})),r=Object(i.useMemo)((function(){return Object(h.a)((function(t){return t.data}),(function(t,e){return e}),(function(t,e){return t.filter((function(t){return t.user===e}))}))}),[]),a=ct(void 0,{selectFromResult:function(t){return Object(x.a)(Object(x.a)({},t),{},{postsForUser:r(t,e)})}}).postsForUser.map((function(t){var e=t.id,n=t.title;return Object(It.jsx)("li",{children:Object(It.jsx)(l.b,{to:"/posts/".concat(e),children:n})},e)}));return Object(It.jsxs)("section",{children:[Object(It.jsx)("h2",{children:n.name}),Object(It.jsx)("ul",{children:a})]})},_t=function(t){var e=t.notificationDate,n=t.notificationMessage,r=t.notificationUser,a=t.isNew,s=Object(j.e)(Et),c=Object(C.a)(e),i=Object(Gt.a)(c),o=s.find((function(t){return t.id===r}))||{name:"Unknown User"},u=zt()("notification",{new:a});return Object(It.jsxs)("div",{className:u,children:[Object(It.jsxs)("div",{children:[Object(It.jsx)("b",{children:o.name})," ",n]}),Object(It.jsx)("div",{title:c,children:Object(It.jsxs)("i",{children:[i," ago"]})})]})},te=function(){var t=Object(j.d)(),e=bt().data,n=void 0===e?[]:e,r=Object(j.e)(Pt);return Object(i.useLayoutEffect)((function(){t(Nt())})),Object(It.jsxs)("section",{children:[Object(It.jsx)("h2",{children:"Notifications"}),n.map((function(t){var e=t.date,n=t.message,a=t.id,s=t.user;return Object(It.jsx)(_t,{notificationDate:e,notificationMessage:n,notificationUser:s,isNew:r[a].isNew},a)}))]})};var ee=function(){return Object(It.jsxs)(l.a,{children:[Object(It.jsx)(At,{}),Object(It.jsx)("div",{className:"App",children:Object(It.jsxs)(b.d,{children:[Object(It.jsx)(b.b,{exact:!0,path:"/",render:function(){return Object(It.jsxs)(It.Fragment,{children:[Object(It.jsx)(Rt,{}),Object(It.jsx)(Vt,{})]})}}),Object(It.jsx)(b.b,{exact:!0,path:"/posts/:postId",component:Xt}),Object(It.jsx)(b.b,{exact:!0,path:"/edit-post/:postId",component:Yt}),Object(It.jsx)(b.b,{exact:!0,path:"/users",component:Zt}),Object(It.jsx)(b.b,{exact:!0,path:"/users/:userId",component:$t}),Object(It.jsx)(b.b,{exact:!0,path:"/notifications",component:te}),Object(It.jsx)(b.a,{to:"/"})]})})]})},ne=Object(O.a)({reducer:Object(m.a)({notifications:St},st.reducerPath,st.reducer),middleware:function(t){return t().concat(st.middleware)}});function re(){return(re=Object(a.a)(c.a.mark((function t(){return c.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,H.start({onUnhandledRequest:"bypass"});case 2:ne.dispatch(Tt.endpoints.getUsers.initiate()),d.a.render(Object(It.jsx)(o.a.StrictMode,{children:Object(It.jsx)(j.a,{store:ne,children:Object(It.jsx)(ee,{})})}),document.getElementById("root"));case 4:case"end":return t.stop()}}),t)})))).apply(this,arguments)}!function(){re.apply(this,arguments)}()},149:function(t,e,n){}},[[1322,1,2]]]);
//# sourceMappingURL=main.b1f2ef0c.chunk.js.map